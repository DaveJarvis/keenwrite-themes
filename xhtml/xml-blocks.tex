% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%
% Map block-level elements to macros
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

% Indented quotations.
\startxmlsetups xml:blockquote
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:blockquote:p
  \xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:blockquote:single
  \startquotation
    \xmlflush{#1}
  \stopquotation
\stopxmlsetups

\startxmlsetups xml:blockquote:began
  \startquotation
    \xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:blockquote:multiple:middle
    \par\xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:blockquote:ended
    \par\xmlflush{#1}
  \stopquotation
\stopxmlsetups

% Paragraphs are followed by a paragraph break, but only if not nested.
\startxmlsetups xml:p
  \xmldoifnotselfempty {#1} {
    \dontleavehmode
    \ignorespaces
    \xmlflush{#1}
    \removeunwantedspaces
  }
  \par
\stopxmlsetups

% Define a start/stop environment for preformatted text.
\definelines[preformatted]

\startxmlsetups xml:pre
  \startxmldisplayverbatim
    \xmlflushspacewise{#1}
  \stopxmldisplayverbatim
\stopxmlsetups

% Ensure that escaped entities and newlines are respected.
\startxmlsetups xml:pre:code
  \startxmldisplayverbatim
    \xmlflushspacewise{#1}
  \stopxmldisplayverbatim
\stopxmlsetups

% Map arbitrary div classes, defined by fenced divs.
\startxmlsetups xml:div
  \start[\xmlatt{#1}{class}]\xmlflush{#1}\stop
\stopxmlsetups

